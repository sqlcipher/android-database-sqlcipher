apply plugin: "com.android.library"
apply from: "native.gradle"

android {

  compileSdkVersion 26
  buildToolsVersion "26.0.1"

  defaultConfig {
    minSdkVersion 14
    targetSdkVersion 26
    versionCode 1
    versionName "${clientVersionNumber}"
  }

  buildTypes {
    release {
      minifyEnabled false
    }
  }

  sourceSets {
    main {
      jniLibs.srcDirs "${rootProject.ext.nativeRootOutputDir}/libs32/",
      "${rootProject.ext.nativeRootOutputDir}/libs64/"
    }
  }

  clean.dependsOn cleanNative

  preBuild.dependsOn([buildOpenSSL, buildAmalgamation])

  afterEvaluate {
    android.libraryVariants.all { variant ->
      variant.javaCompile.dependsOn([buildNative32, buildNative64])
      variant.outputs.each { output ->
        def outputFile = output.outputFile
        if (outputFile != null && outputFile.name.endsWith(".aar")) {
          def fileName = "${archivesBaseName}-${clientVersionNumber}.aar"
          output.outputFile = new File(outputFile.parent, fileName)
        }
      }
    }
  }

}
